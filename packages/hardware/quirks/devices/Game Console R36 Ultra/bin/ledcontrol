#!/bin/bash

# Get the first parameter of the script, which is the color name
COLOR=$1

# Define the LED path corresponding to each color
LED_BLUE="/sys/class/leds/blue:status/brightness"
LED_GREEN="/sys/class/leds/green:status/brightness"
LED_RED="/sys/class/leds/red:charging/brightness"

# Define a function to set the brightness of the LED
set_led_brightness() {
    local led=$1
    local brightness=$2
    if [ -w "$led" ]; then
        echo "$brightness" > "$led"
    else
        echo "Error: Unable to write to $led"
    fi
}

# Set the LED state based on the color name
case $COLOR in
    battery)
        # Assume that battery corresponds to green (can be adjusted according to actual needs)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 0
        set_led_brightness "$LED_GREEN" 1
        set_led_brightness "$LED_RED" 0
        set_setting led.color ${1}
        systemctl restart batteryledstatus.service
        ;;
    red)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 0
        set_led_brightness "$LED_GREEN" 0
        set_led_brightness "$LED_RED" 1
        set_setting led.color ${1}
        ;;
    green)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 0
        set_led_brightness "$LED_GREEN" 1
        set_led_brightness "$LED_RED" 0
        set_setting led.color ${1}
        ;;
    blue)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 1
        set_led_brightness "$LED_GREEN" 0
        set_led_brightness "$LED_RED" 0
        set_setting led.color ${1}
        ;;
    cyan)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 1
        set_led_brightness "$LED_GREEN" 1
        set_led_brightness "$LED_RED" 0
        set_setting led.color ${1}
        ;;
    white)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 1
        set_led_brightness "$LED_GREEN" 1
        set_led_brightness "$LED_RED" 1
        set_setting led.color ${1}
        ;;
    yellow)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 0
        set_led_brightness "$LED_GREEN" 1
        set_led_brightness "$LED_RED" 1
        set_setting led.color ${1}
        ;;
    purple)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 1
        set_led_brightness "$LED_GREEN" 0
        set_led_brightness "$LED_RED" 1
        set_setting led.color ${1}
        ;;
    flow)
        # Cycle through colors: red, green, blue, cyan, white, yellow, purple
        while true; do
        echo 0 > "$LED_BLUE"; echo 0 > "$LED_GREEN"; echo 1 > "$LED_RED"; sleep 1  # red
        echo 0 > "$LED_BLUE"; echo 1 > "$LED_GREEN"; echo 0 > "$LED_RED"; sleep 1  # green
        echo 1 > "$LED_BLUE"; echo 0 > "$LED_GREEN"; echo 0 > "$LED_RED"; sleep 1  # blue
        echo 1 > "$LED_BLUE"; echo 1 > "$LED_GREEN"; echo 0 > "$LED_RED"; sleep 1  # cyan
        echo 1 > "$LED_BLUE"; echo 1 > "$LED_GREEN"; echo 1 > "$LED_RED"; sleep 1  # white
        echo 0 > "$LED_BLUE"; echo 1 > "$LED_GREEN"; echo 1 > "$LED_RED"; sleep 1  # yellow
        echo 1 > "$LED_BLUE"; echo 0 > "$LED_GREEN"; echo 1 > "$LED_RED"; sleep 1  # purple
        done &
        set_setting led.color ${1}
        ;;
    off)
        pkill -f "bash.*ledcontrol flow"
        set_led_brightness "$LED_BLUE" 0
        set_led_brightness "$LED_GREEN" 0
        set_led_brightness "$LED_RED" 0
        set_setting led.color ${1}
        ;;
    list)
cat <<EOF
off
battery
red
green
blue
cyan
white
yellow
purple
flow
EOF
  ;;
esac
